-- EX 1:
SELECT A.CONTINENT, 
FLOOR(AVG(B.POPULATION))
FROM COUNTRY AS A
JOIN CITY AS B
ON A.CODE = B.COUNTRYCODE
GROUP BY A.CONTINENT;

-- EX 2:
SELECT 

ROUND(CAST ( SUM (
CASE 
  WHEN B.signup_action IN ('Confirmed') THEN 1
  ELSE 0
END) AS DECIMAL) /  COUNT(DISTINCT A.user_id) ,2) AS confirm_rate

FROM EMAILS AS A  
LEFT JOIN TEXTS AS B  
ON A.email_id = B.email_id;

-- EX 3:
SELECT A.age_bucket,

ROUND(100*SUM(CASE
  WHEN activity_type = 'send' THEN time_spent
  ELSE 0
END) / (SUM(CASE WHEN activity_type = 'send' THEN time_spent ELSE 0 END) + 
      SUM(CASE WHEN activity_type = 'open' THEN time_spent ELSE 0 END)), 2) AS send_perc	,

ROUND(100*SUM(CASE
  WHEN activity_type = 'open' THEN time_spent
  ELSE 0
END)  / (SUM(CASE WHEN activity_type = 'send' THEN time_spent ELSE 0 END) + 
      SUM(CASE WHEN activity_type = 'open' THEN time_spent ELSE 0 END)), 2) AS open_perc

FROM age_breakdown AS A
LEFT JOIN activities AS B
ON A.user_id = B.user_id
GROUP BY A.age_bucket
ORDER BY A.age_bucket ;

-- EX 4:
SELECT A.customer_id

FROM customer_contracts AS A
JOIN products  AS B  
ON A.product_id = B.product_id
GROUP BY A.customer_id
HAVING SUM(CASE  
  WHEN (B.product_category = 'Analytics' OR B.product_category = 'Containers' OR B.product_category = 'Compute') AND  product_name LIKE 'Azure%' 
  THEN 1
  ELSE 0
END) > 2

-- EX 5 (???????????)
SELECT *
FROM Employees AS A
LEFT JOIN Employees AS B
ON A.reports_to = B.employee_id  
GROUP BY A.employee_id ;

-- EX 6:
SELECT A.product_name,
SUM(unit) AS unit 
FROM Products AS A
LEFT JOIN Orders AS B
ON A.product_id = B.product_id 
WHERE order_date BETWEEN '2020-02-01' AND '2020-02-29'
GROUP BY A.product_name
HAVING SUM(unit) >= 100

-- EX 7:
SELECT A.page_id
FROM pages AS A  
LEFT JOIN page_likes AS B  
ON A.page_id = B.page_id
WHERE B.liked_date IS NULL
ORDER BY A.page_id;









